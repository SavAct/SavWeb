"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[767],{72767:(e,t,o)=>{o.r(t),o.d(t,{default:()=>M});var n=o(59835),i=o(86970),a=o(61957);const r={class:"row q-pt-md q-pb-sm q-px-md"},l={class:"col-auto q-ml-sm"},s={class:"col q-pr-sm"},c={class:"col-auto"},d=(0,n._)("br",null,null,-1),u=(0,n._)("br",null,null,-1),m={class:"full-width row flex-center q-gutter-sm"},p={class:"col q-pr-sm"},y={class:"col-auto q-pr-sm"},f={class:"col-auto"},g=(0,n._)("br",null,null,-1),h=(0,n._)("br",null,null,-1),v={class:"row justify-center items-center full-width"},w={class:"full-width row flex-center q-gutter-sm"};function b(e,t,o,b,S,k){const T=(0,n.up)("q-btn"),_=(0,n.up)("q-input"),P=(0,n.up)("q-tooltip"),U=(0,n.up)("trx-tool-tip"),C=(0,n.up)("q-avatar"),A=(0,n.up)("q-td"),I=(0,n.up)("q-tr"),x=(0,n.up)("q-table"),H=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(H,{class:"items-center justify-evenly",style:{position:"relative",height:"100%"}},{default:(0,n.w5)((()=>{var o;return[(0,n._)("div",r,[(0,n._)("div",{class:(0,i.C_)(["col",e.$q.screen.gt.xs?"text-h5":"text-h6"])},"SavAct Payments",2),(0,n._)("div",l,[(0,n.Wm)(T,{class:"col-auto q-ml-sm",label:`${null===(o=e.chain)||void 0===o?void 0:o.name} Network`,onClick:e.showWalletDialog,outline:""},null,8,["label","onClick"])])]),(0,n.Wm)(x,{title:"Incommings",class:"q-mx-sm card",rows:e.inRows,columns:e.inColumns,"row-key":e.rowKey,color:"amber",loading:e.loadingUpdateIn,"no-data-label":e.t("hintHistoryUse")},{top:(0,n.w5)((()=>[(0,n._)("div",s,[(0,n.Wm)(_,{modelValue:e.user,"onUpdate:modelValue":t[0]||(t[0]=t=>e.user=t),dense:"",type:"text",label:e.t("user"),onKeydown:t[1]||(t[1]=(0,a.D2)((t=>e.updateIn()),["enter"]))},null,8,["modelValue","label"])]),(0,n._)("div",c,[(0,n.Wm)(T,{icon:"update",label:"In",loading:e.loadingUpdateIn,outline:"",onClick:t[2]||(t[2]=t=>e.updateIn()),disable:e.loadingUpdateIn},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("update")),1)])),_:1})])),_:1},8,["loading","disable"])])])),body:(0,n.w5)((t=>[(0,n.Wm)(I,{props:t,class:(0,i.C_)(["cursor-pointer",t.row.removed?e.brightStyle?"bg-grey":"bg-grey-10":""]),onClick:o=>e.onRowClick(t.row,!0)},{default:(0,n.w5)((()=>[(0,n.Wm)(U,{trx:t.row},null,8,["trx"]),(0,n.Wm)(A,{key:"type",props:t},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{"text-color":"black",size:"md",color:e.colorStatus(t.row.time),icon:0==t.row.type?"shopping_cart":"poll"},null,8,["color","icon"])])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"id",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.id),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"sender",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortAddress(t.row.sender)),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"fund",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.orifund),1),d,(0,n.Uk)((0,i.zw)(t.row.contract),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"time",props:t},{default:(0,n.w5)((()=>[t.row.time>1?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleTimeString()),1),u,(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleDateString()),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)("-")],64))])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"memo",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortenText(e.StringToUtf8String(t.row.memo))),1)])),_:2},1032,["props"])])),_:2},1032,["props","class","onClick"])])),"no-data":(0,n.w5)((({message:e})=>[(0,n._)("div",m,[(0,n._)("span",null,(0,i.zw)(e),1)])])),_:1},8,["rows","columns","row-key","loading","no-data-label"]),(0,n.Wm)(x,{title:"Outgoings",class:"q-mx-sm q-my-md card",rows:e.outRows,columns:e.outColumns,"row-key":e.rowKey,color:"amber",loading:e.loadingUpdateOut,"no-data-label":e.t("hintHistoryUse")},{top:(0,n.w5)((()=>[(0,n._)("div",p,[(0,n.Wm)(_,{modelValue:e.to,"onUpdate:modelValue":t[3]||(t[3]=t=>e.to=t),dense:"",type:"text",label:e.t("recipient"),onKeydown:t[4]||(t[4]=(0,a.D2)((t=>e.search(0)),["enter"]))},null,8,["modelValue","label"])]),(0,n._)("div",y,[(0,n.Wm)(T,{icon:"search",outline:"",onClick:t[5]||(t[5]=t=>e.search(0)),disable:e.loadingSearch||e.loadingUpdateOut},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("searchDeeper")),1)])),_:1})])),_:1},8,["disable"])]),(0,n._)("div",f,[(0,n.Wm)(T,{icon:"update",label:"Out",loading:e.loadingUpdateOut,outline:"",onClick:t[6]||(t[6]=t=>e.updateOut()),disable:e.loadingSearch||e.loadingUpdateOut},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("update")),1)])),_:1})])),_:1},8,["loading","disable"])])])),body:(0,n.w5)((t=>[(0,n.Wm)(I,{props:t,class:(0,i.C_)(["cursor-pointer",t.row.removed?e.brightStyle?"bg-grey":"bg-grey-10":""]),onClick:o=>e.onRowClick(t.row,!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(U,{trx:t.row},null,8,["trx"]),(0,n.Wm)(A,{key:"type",props:t},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{"text-color":"black",size:"md",color:e.colorStatus(t.row.time),icon:0==t.row.type?"shopping_cart":"poll"},null,8,["color","icon"])])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"nr",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.nr),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"recipient",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortAddress(t.row.recipient)),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"fund",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.orifund),1),g,(0,n.Uk)((0,i.zw)(t.row.contract),1)])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"time",props:t},{default:(0,n.w5)((()=>[t.row.time>1?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleTimeString()),1),h,(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleDateString()),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)("-")],64))])),_:2},1032,["props"]),(0,n.Wm)(A,{key:"memo",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortenText(e.StringToUtf8String(t.row.memo))),1)])),_:2},1032,["props"])])),_:2},1032,["props","class","onClick"])])),bottom:(0,n.w5)((()=>[(0,n._)("div",v,[e.moreAvailable?((0,n.wg)(),(0,n.j4)(T,{key:0,icon:"add_circle_outline",loading:e.loadingSearch,round:"",onClick:t[7]||(t[7]=t=>e.search(e.lastSearchId)),disable:e.loadingSearch||e.loadingUpdateOut},null,8,["loading","disable"])):(0,n.kq)("",!0)])])),"no-data":(0,n.w5)((({message:e})=>[(0,n._)("div",w,[(0,n._)("span",null,(0,i.zw)(e),1)])])),_:1},8,["rows","columns","row-key","loading","no-data-label"])]})),_:1})}var S=o(60499),k=o(13022),T=o(27712),_=o(6827),P=o(62659),U=o(94345),C=o(7580),A=o(65211),I=o(53103),x=o(74544),H=o(28339),W=o(10818),q=o(3390),D=o(86350),N=o(17779),O=function(e,t,o,n){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function r(e){try{s(n.next(e))}catch(t){a(t)}}function l(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):i(e.value).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const V=(0,n.aZ)({name:"page-history",components:{TrxToolTip:k["default"]},setup(){var e;const t=(0,q.b)(),o=(0,P.r)(),i=(0,T.QT)({useScope:"global"}).t.bind(this),a=(0,H.yj)(),r=(0,H.tv)(),l=a.query;"chain"in l&&"string"==typeof l.chain&&o.selectChain(l.chain);const s=(0,n.Fl)((()=>t.brightStyle));!o.historyUserInput&&(null===(e=o.walletUser)||void 0===e?void 0:e.name)&&o.setHistoryUserInput(o.walletUser.name);const c=(0,n.Fl)((()=>o.historyUserInput.length>13?I.PublicKey.fromString(o.historyUserInput).toString():o.historyUserInput)),d=(0,n.Fl)((()=>o.historyRecipientInput.length>13?I.PublicKey.fromString(o.historyRecipientInput).toString():o.historyRecipientInput)),u=(0,S.iH)(!1),m=(0,S.iH)(!1),p=(0,S.iH)(!1),y=(0,S.iH)(!1),f=(0,S.iH)(-1),g=(0,n.Fl)((()=>{var e;return null===(e=o.selectedConnect)||void 0===e?void 0:e.chainParams}));N.log("user norm",c.value),o.iniHistory(c.value);const h=(0,S.iH)(o.historyUserInput?o.historyUserInput:""),v=(0,n.Fl)({get:()=>h.value,set:e=>{h.value=e,e.length<=13&&(e=e.toLowerCase()),(0,U.isNameValid)(e)||e.length>52&&A.b.isValidPublic(e)?o.setHistoryUserInput(e):o.setHistoryUserInput(void 0)}}),w=(0,S.iH)(o.historyRecipientInput?o.historyRecipientInput:""),b=(0,n.Fl)({get:()=>w.value,set:e=>{w.value=e,e.length<=13&&(e=e.toLowerCase()),(0,U.isNameValid)(e)||e.length>52&&A.b.isValidPublic(e)?o.setHistoryRecipientInput(e):o.setHistoryRecipientInput("")}});function k(e){return O(this,void 0,void 0,(function*(){const t=c.value;if(!t)return void _.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"});const n=d.value;if(!n)return void _.Z.create({type:"negative",message:i("noRecipientDefined"),caption:i("enterRecipientFirst"),position:"top"});const a=o.selectedConnect;if(!a)return void _.Z.create({type:"negative",message:i("noChainDefined"),position:"top"});if(u.value)return;let r;if(u.value=!0,(0,U.isNameValid)(t))r=(0,C.nameToFromHex)(t);else{if(!A.b.isValidPublic(t))return _.Z.create({type:"negative",message:t.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),void(u.value=!1);r=(0,C.hexWithTypeOfPubKey)(I.PublicKey.fromString(t))}const l=200,s=Date.now();let m;try{if((0,U.isNameValid)(n)){const i=yield a.get_table_rows({code:a.chainParams.savpayContract,table:"pay2name",scope:n,lower_bound:String(e),limit:l,json:!1});if(m=D.SavActPayTableType.pay2name,i.rows.length>0)for(const e of i.rows){const i=(0,D.rawSavActPaymentToObject)(e,m);void 0!=i&&r===i.from&&void 0!=i.fund.symbol&&o.updateHistoryOutTrx(t,{sender:t,recipient:n,id:Number(i.id),fund:(0,U.AssetToString)(i.fund),orifund:(0,U.AssetToString)({amount:i.orisent,symbol:i.fund.symbol}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:s,removed:!1,chain:a.chainParams.shortName?a.chainParams.shortName:a.chainParams.chainId})}y.value=i.more}else if(A.b.isValidPublic(n)){const c=I.PublicKey.fromString(n),d=(0,C.splitPubKeyToScopeAndTableVec)(c),p=yield a.get_table_rows({code:a.chainParams.savpayContract,table:"pay2key",scope:d.scope.toString(),limit:200,json:!1,reverse:!0});if(m=D.SavActPayTableType.pay2key,!(p.rows.length>0))return _.Z.create({type:"negative",message:t.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),void(u.value=!1);for(const e of p.rows){const i=(0,D.rawSavActPaymentToObject)(e,m);void 0!=i&&r===i.from&&void 0!=i.fund.symbol&&(void 0!==i.to&&i.to===d.tableVec&&o.updateHistoryOutTrx(t,{sender:t,recipient:n,id:Number(i.id),fund:(0,U.AssetToString)(i.fund),orifund:(0,U.AssetToString)({amount:i.orisent,symbol:i.fund.symbol}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:s,removed:!1,chain:a.chainParams.shortName?a.chainParams.shortName:a.chainParams.chainId}))}const g=e,h=e+l;o.user[t].outHistory.forEach(((e,n)=>{e.lastUpdate!=s&&e.id>=g&&e.id<g&&o.markRemovedOutTrx(t,n)})),f.value=h,y.value=p.more}else _.Z.create({type:"negative",message:n.length<13?i("invalidAcc"):i("invalidPub"),position:"top"})}catch(p){N.log("Error on requesting data",p)}finally{u.value=!1}}))}function V(e){return O(this,void 0,void 0,(function*(){const t=o.selectedConnect;if(!t)return _.Z.create({type:"negative",message:i("noChainDefined"),position:"top"}),!1;try{let n=!0,a=0;const r=200;while(n){const l=Date.now();let s;if((0,U.isNameValid)(e)){const i=yield t.get_table_rows({code:t.chainParams.savpayContract,table:"pay2name",scope:e,lower_bound:String(a),limit:r,reverse:!0,json:!1});if(s=D.SavActPayTableType.pay2name,i.rows.length>0)for(const n of i.rows){const i=(0,D.rawSavActPaymentToObject)(n,s);void 0!=i&&void 0!=i.fund.symbol&&o.updateHistoryInTrx(e,{sender:(0,C.hexTypeOfPubKeyToNameOrKeyStr)(i.from),recipient:e,id:Number(i.id),fund:(0,U.AssetToString)(i.fund),orifund:(0,U.AssetToString)({amount:i.orisent,symbol:i.fund.symbol}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:l,removed:!1,chain:t.chainParams.shortName?t.chainParams.shortName:t.chainParams.chainId})}n=i.more}else{if(!A.b.isValidPublic(e))return _.Z.create({type:"negative",message:e.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),!1;{const i=I.PublicKey.fromString(e),c=(0,C.splitPubKeyToScopeAndTableVec)(i);e=i.toString();const d=yield t.get_table_rows({code:t.chainParams.savpayContract,table:"pay2key",scope:c.scope.toString(),lower_bound:String(a),limit:r,reverse:!0,json:!1});if(s=D.SavActPayTableType.pay2key,d.rows.length>0)for(const n of d.rows){const i=(0,D.rawSavActPaymentToObject)(n,s);void 0!=i&&void 0!=i.fund.symbol&&o.updateHistoryInTrx(e,{sender:(0,C.hexTypeOfPubKeyToNameOrKeyStr)(i.from),recipient:e,id:Number(i.id),fund:(0,U.AssetToString)(i.fund),orifund:(0,U.AssetToString)({amount:i.orisent,symbol:i.fund.symbol}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:l,removed:!1,chain:t.chainParams.shortName?t.chainParams.shortName:t.chainParams.chainId})}n=d.more}}a+=r,yield(0,x.sleep)(1e3)}}catch(n){return N.log("Error on requesting data",n),!1}return!0}))}function Z(e){return O(this,void 0,void 0,(function*(){const t=o.selectedConnect;if(!t)return _.Z.create({type:"negative",message:i("noChainDefined"),position:"top"}),!1;const n=Date.now();try{if(!o.user[e]||!o.user[e].outHistory||o.user[e].outHistory.length<=0)return _.Z.create({type:"negative",message:i("noOutHistory"),position:"top"}),!1;for(const a of o.user[e].outHistory)if(!a.removed){let r,l,s,c="",d=!1;if((0,U.isNameValid)(a.recipient))r="pay2name",s=D.SavActPayTableType.pay2name,l=e;else{if(!A.b.isValidPublic(a.recipient))return _.Z.create({type:"negative",message:a.recipient.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),!1;{d=!0;const e=I.PublicKey.fromString(a.recipient),t=(0,C.splitPubKeyToScopeAndTableVec)(e);r="pay2key",s=D.SavActPayTableType.pay2key,l=String(t.scope),c=t.tableVec}}const u=yield t.get_table_rows({code:t.chainParams.savpayContract,table:r,scope:l,lower_bound:String(a.id),upper_bound:String(a.id),reverse:!0,json:!1});if(!("rows"in u&&u.rows.length>0))return!1;{const i=u.rows[0],r=(0,D.rawSavActPaymentToObject)(i,s);if(void 0==r||void 0==r.fund.symbol)continue;if(d&&(void 0===r.to||c!=r.to))return!1;o.updateHistoryOutTrx(e,{sender:e,recipient:a.recipient,id:Number(r.id),fund:(0,U.AssetToString)(r.fund),orifund:(0,U.AssetToString)({amount:r.orisent,symbol:r.fund.symbol}),memo:r.memo,ramBy:r.ramBy,type:r.type,time:r.time,contract:r.contract,lastUpdate:n,removed:!1,chain:t.chainParams.shortName?t.chainParams.shortName:t.chainParams.chainId})}}}catch(a){return N.log("Error on requesting data",a),!1}return!0}))}function z(){return O(this,void 0,void 0,(function*(){const e=c.value;e?m.value||(m.value=!0,yield V(e),m.value=!1):_.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"})}))}function K(){return O(this,void 0,void 0,(function*(){const e=c.value;e?p.value||(p.value=!0,yield Z(e),p.value=!1):_.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"})}))}const R=[{name:"type",align:"left",label:"",field:"type"},{name:"id",align:"left",label:"Id",field:"id",sortable:!0},{name:"sender",align:"left",label:i("sender"),field:"sender",sortable:!0},{name:"fund",align:"left",label:i("fund"),field:"fund",sortable:!0},{name:"time",align:"center",label:i("deadline"),field:"time",sortable:!0},{name:"memo",align:"left",label:"Memo",field:"memo"}],j=[{name:"type",align:"left",label:"",field:"type"},{name:"nr",align:"left",label:"Local nr.",field:"nr",sortable:!0},{name:"recipient",align:"left",label:i("recipient"),field:"recipient"},{name:"fund",align:"left",label:i("fund"),field:"fund",sortable:!0},{name:"time",align:"center",label:i("deadline"),field:"time",sortable:!0},{name:"memo",align:"left",label:"Memo",field:"memo"}],F=(0,n.Fl)((()=>{var e;if(o.user[c.value]){const t=null===(e=o.selectedConnect)||void 0===e?void 0:e.chainParams.shortName;return o.user[c.value].inHistory.filter((e=>e.chain===t))}return[]})),B=(0,n.Fl)((()=>{var e;if(o.user[c.value]){const t=null===(e=o.selectedConnect)||void 0===e?void 0:e.chainParams.shortName;return d.value.length>0?o.user[c.value].outHistory.filter((e=>e.recipient==d.value&&e.chain===t)):o.user[c.value].outHistory}return[]}));function Q(e,t){let o=t?{user:e.recipient,from:e.sender,id:e.id,chain:e.chain}:{user:e.sender,to:e.recipient,id:e.id,chain:e.chain};r.push({name:"action",query:o})}function L(e){return`${e.sender} ${e.recipient} ${e.id}`}return"to"in l&&"string"==typeof l.to&&(b.value=l.to),"user"in l&&"string"==typeof l.user&&(v.value=l.user,z()),{t:i,brightStyle:s,user:v,to:b,search:k,loadingSearch:u,moreAvailable:y,lastSearchId:f,updateIn:z,updateOut:K,loadingUpdateIn:m,loadingUpdateOut:p,eosioStore:o,chain:g,showWalletDialog:o.showWalletDialog,inColumns:R,outColumns:j,inRows:F,outRows:B,shortAddress:U.shortAddress,shortenText:U.shortenText,onRowClick:Q,rowKey:L,colorStatus:W.colorStatus,StringToUtf8String:D.StringToUtf8String}}});var Z=o(11639),z=o(69885),K=o(68879),R=o(31746),j=o(13119),F=o(46858),B=o(31233),Q=o(67220),L=o(61357),$=o(69984),E=o.n($);const Y=(0,Z.Z)(V,[["render",b]]),M=Y;E()(V,"components",{QPage:z.Z,QBtn:K.Z,QTable:R.Z,QInput:j.Z,QTooltip:F.Z,QTr:B.Z,QTd:Q.Z,QAvatar:L.Z})}}]);