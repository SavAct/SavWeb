"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[996],{74996:(e,t,o)=>{o.r(t),o.d(t,{default:()=>le});var a=o(59835),l=o(86970),n=o(61957);const i={class:"row justify-between no-wrap"},s={class:"row q-mb-md"},u={key:0,class:"row q-mb-sm"},r={class:"q-mx-md"},d={class:"column items-center"},c={class:"text-center"},v={class:"row justify-between"},m=(0,a._)("div",{class:"col"},"Transfer",-1),h={class:"row justify-between"},f={class:"col"},g={class:"q-ml-md"},p={class:"h4"};function y(e,t,o,y,w,C){const b=(0,a.up)("bridge-select"),T=(0,a.up)("q-card-section"),k=(0,a.up)("q-card"),E=(0,a.up)("q-btn"),I=(0,a.up)("wallet-eosio"),_=(0,a.up)("wallet-eth"),S=(0,a.up)("q-item-label"),q=(0,a.up)("q-item-section"),B=(0,a.up)("q-item"),H=(0,a.up)("q-list"),W=(0,a.up)("q-menu"),O=(0,a.up)("asset-field"),x=(0,a.up)("q-icon"),$=(0,a.up)("q-toggle"),A=(0,a.up)("q-spinner-box"),F=(0,a.up)("q-separator"),Z=(0,a.up)("teleport-list"),N=(0,a.up)("q-page"),U=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(N,{class:"column",style:{height:"100%"}},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a.Wm)(k,{class:"col q-mx-md q-my-sm card"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{class:"q-py-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{class:"q-mt-sm",contract:e.eosioContractModel,"onUpdate:contract":t[0]||(t[0]=t=>e.eosioContractModel=t),custom:e.customBridge,"onUpdate:custom":t[1]||(t[1]=t=>e.customBridge=t),selected:e.sBridge,"onUpdate:selected":t[2]||(t[2]=t=>e.sBridge=t),bridges:e.bridges,"onUpdate:bridges":t[3]||(t[3]=t=>e.bridges=t),onAddbridge:t[4]||(t[4]=t=>e.bridges.push(t))},null,8,["contract","custom","selected","bridges"])])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(E,{class:"q-py-md",style:{"border-radius":"0 0 0 5px"},size:"md","icon-right":"settings",color:"grey",to:{name:"setup-teleport",query:e.sBridge?{eosio:e.sEosioChain?e.sEosioChain.contract:void 0,eth:e.sEthChain?e.sEthChain.contract:void 0}:void 0}},null,8,["to"])])]),(0,a.Wm)(k,{class:"q-mx-md q-my-sm card"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,null,{default:(0,a.w5)((()=>[(0,a._)("div",s,[(0,a.Wm)(I,{class:"col-12 col-sm",onAccount:e.getEosioBalance},null,8,["onAccount"])]),e.sEthChain?((0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(_,{class:"col-12 col-sm",onConnected:e.ethConnectChanged,onAccount:e.setEthAccount,chainId:e.ethChainId,"onUpdate:chainId":t[5]||(t[5]=t=>e.ethChainId=t)},null,8,["onConnected","onAccount","chainId"])])):(0,a.kq)("",!0)])),_:1})])),_:1}),(0,a.wy)((0,a._)("div",r,[e.sBridge&&e.direction&&e.sEosioChain&&e.sEthChain?((0,a.wg)(),(0,a.iD)("div",{key:0,class:(0,l.C_)(["row justify-between q-mt-sm q-mb-md",0==e.direction.from?"":e.$q.screen.gt.xs?"reverse":"column reverse"])},[(0,a.Wm)(k,{class:"col-12 col-sm-5 col-md-4 column items-center bg-primary"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{class:"full-width"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(E,{color:"primary",label:e.sEosioChain.shortName,"icon-right":e.sBridge.eosio.length>1?"arrow_drop_down":""},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{"auto-close":"",fit:""},{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.sBridge.eosio,((t,o)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:o},[e.sEosioChain&&e.sEosioChain.id!=t.id?(0,a.wy)(((0,a.wg)(),(0,a.j4)(B,{key:0,clickable:"",onClick:t=>{var a;return e.selectChain(null===(a=e.sEosioChain)||void 0===a?void 0:a.type,o)}},{default:(0,a.w5)((()=>[(0,a.Wm)(q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(t.shortName),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[U]]):(0,a.kq)("",!0)],64)))),128))])),_:1})])),_:1})])),_:1},8,["label","icon-right"])]),(0,a.Wm)(O,{class:"q-pt-md full-width",label:e.t("balance"),readonly:"",dense:"",amount:e.currentBalance.eosio,"onUpdate:amount":t[6]||(t[6]=t=>e.currentBalance.eosio=t),symbol:e.sSymbol,onRefresh:e.getEosioBalance,loading:e.balanceLoading.eosio},null,8,["label","amount","symbol","onRefresh","loading"])])),_:1})])),_:1}),(0,a._)("div",{class:(0,l.C_)(["col-12 col-sm-2 col-md-4",e.$q.screen.lt.sm?"q-py-sm":"q-px-sm"])},[(0,a.Wm)(B,{clickable:"",onClick:e.toggleDirection},{default:(0,a.w5)((()=>[(0,a.Wm)(q,null,{default:(0,a.w5)((()=>[(0,a._)("div",d,[(0,a.Wm)(x,{name:e.$q.screen.gt.xs?"arrow_circle_right":"arrow_circle_down",size:e.$q.screen.gt.sm?"100px":"50px"},null,8,["name","size"]),(0,a._)("div",c,(0,l.zw)(e.t("changeDirection")),1)])])),_:1})])),_:1},8,["onClick"])],2),(0,a.Wm)(k,{class:"col-12 col-sm-5 col-md-4 column items-center bg-secondary rounded"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{class:"full-width"},{default:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a.Wm)(E,{color:"secondary",label:e.sEthChain.shortName,"icon-right":e.sBridge.eth.length>1?"arrow_drop_down":""},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{"auto-close":"",fit:""},{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.sBridge.eth,((t,o)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:o},[e.sEthChain&&e.sEthChain.id!=t.id?(0,a.wy)(((0,a.wg)(),(0,a.j4)(B,{key:0,clickable:"",onClick:t=>{var a;return e.selectChain(null===(a=e.sEthChain)||void 0===a?void 0:a.type,o)}},{default:(0,a.w5)((()=>[(0,a.Wm)(q,null,{default:(0,a.w5)((()=>[(0,a.Wm)(S,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(t.shortName),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[U]]):(0,a.kq)("",!0)],64)))),128))])),_:1})])),_:1})])),_:1},8,["label","icon-right"]),(0,a.Wm)(E,{round:"",icon:"add",onClick:e.addToken},null,8,["onClick"])]),(0,a.Wm)(O,{class:"q-pt-md full-width",label:e.t("balance"),readonly:"",dense:"",amount:e.currentBalance.eth,"onUpdate:amount":t[7]||(t[7]=t=>e.currentBalance.eth=t),symbol:e.sSymbol,onRefresh:e.getEthBalance,loading:e.balanceLoading.eth},null,8,["label","amount","symbol","onRefresh","loading"])])),_:1})])),_:1})],2)):(0,a.kq)("",!0),e.sBridge?((0,a.wg)(),(0,a.j4)(k,{key:1,class:"q-mt-sm q-mb-md card"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{top:"",class:"row q-py-sm"},{default:(0,a.w5)((()=>[m,(0,a._)("div",null,[(0,a.Wm)(E,{class:"colored-btn q-px-sm",dense:"",size:"10px",color:"red",label:"Max",onClick:e.selectMax},null,8,["onClick"])])])),_:1}),(0,a.Wm)(T,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a._)("div",h,[(0,a._)("div",f,[(0,a.Wm)(O,{dense:"",amount:e.sendAmount,"onUpdate:amount":t[8]||(t[8]=t=>e.sendAmount=t),rules:e.sendRules,symbol:e.sSymbol,hint:e.feeHint},null,8,["amount","rules","symbol","hint"])]),(0,a._)("div",g,[(0,a.Wm)(E,{onClick:e.sendTeleport,flat:"",icon:"send",rounded:"",size:"xl"},null,8,["onClick"])])])])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(k,{class:"q-my-sm card"},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{class:"row q-px-md q-my-none q-py-sm"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)($,{class:"col",modelValue:e.showFinshed,"onUpdate:modelValue":t[9]||(t[9]=t=>e.showFinshed=t),label:e.t("showFinished")},null,8,["modelValue","label"]),[[n.F8,e.teleports.length]]),(0,a.wy)((0,a._)("div",p,[(0,a.Uk)(" Teleport is running "),(0,a.Wm)(A,{class:"text-center",color:"primary",size:"4em"})],512),[[n.F8,e.loadingEosioTel||e.loadingEthTel]])])),_:1}),(0,a.wy)((0,a.Wm)(F,{inset:""},null,512),[[n.F8,e.teleports.length]]),(0,a.Wm)(T,{class:"q-my-none q-py-none"},{default:(0,a.w5)((()=>[e.sBridge?((0,a.wg)(),(0,a.j4)(Z,{key:0,bridge:e.sBridge,teleports:e.teleports,showFinshed:e.showFinshed,onClaimClick:e.claimClick},null,8,["bridge","teleports","showFinshed","onClaimClick"])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(T,{class:"q-my-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(E,{class:"full-width card-btn",onClick:t[10]||(t[10]=t=>e.get_last_Teleports()),label:e.t("getLastTeleports"),loading:e.loadTeleports},null,8,["label","loading"])])),_:1})])),_:1})],512),[[n.F8,e.ethConnected&&e.walletUser]])])),_:1})}var w=o(6827),C=o(5980),b=o(60499),T=o(28339),k=o(27712),E=o(6342),I=o(25509),_=o(23871),S=o(28045),q=o(90799),B=o(79039),H=o(74544),W=o(72354),O=o(3318),x=o(94345),$=o(18475),A=o(64096),F=o(62659),Z=o(17779),N=function(e,t,o,a){function l(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,n){function i(e){try{u(a.next(e))}catch(t){n(t)}}function s(e){try{u(a["throw"](e))}catch(t){n(t)}}function u(e){e.done?o(e.value):l(e.value).then(i,s)}u((a=a.apply(e,t||[])).next())}))};const U=(0,a.aZ)({name:"page-teleport",components:{TeleportList:I["default"],AssetField:_["default"],WalletEosio:S["default"],WalletEth:q["default"],BridgeSelect:B["default"]},setup(){const e=(0,F.r)(),t=(0,a.Fl)((()=>e.allConnects)),o=(0,a.Fl)((()=>e.walletUser)),l=(0,b.iH)({from:E.ChainType.EOSIO,to:E.ChainType.ETH}),n=(0,a.Fl)({set:e=>{U(e)},get:()=>{if(p.value&&"number"==typeof p.value.metamaskId)return p.value.metamaskId}}),i=(0,k.QT)({useScope:"global"}).t.bind(this),s=(0,b.iH)({eth:BigInt(0),eosio:BigInt(0)}),u=(0,b.iH)({eth:!1,eosio:!1}),r=(0,b.iH)([E.bridgeSavAct,E.bridgeAlienWorld]),d=(0,b.iH)(),c=(0,a.Fl)({set:o=>{var a;if(s.value={eosio:BigInt(0),eth:BigInt(0)},d.value=o,g.value&&(I.value=g.value.contract,(null===(a=e.selectedConnect)||void 0===a?void 0:a.chainParams.chainId)!=g.value.chainHash)){const o=(0,C.GetConnectByChainId)(g.value.chainHash,t.value);o&&e.setSelectedConnect(o)}f()},get:()=>d.value}),v=(0,b.iH)([]),m=(0,b.iH)(!0);function h(){if(g.value&&p.value){Z.log("Set Path",g.value.shortName);const e="eosio",t=l.value.from===E.ChainType.ETH?"from":"to",o=`#${q.path}?bridge=${g.value.contract}&${e}=${g.value.shortName}&${t}=${p.value.shortName}`;history.replaceState(history.state,"",o)}else Z.log("Set no Path"),history.replaceState(history.state,"",`#${q.path}`)}function f(){p.value&&c.value&&(null!=p.value.metamaskId&&n.value!=p.value.metamaskId&&(n.value=p.value.metamaskId),_.value=(0,H.getEthContract)(p.value.contract,window.ethereum,c.value.version)),h()}const g=(0,a.Fl)((()=>{var e;return null===(e=d.value)||void 0===e?void 0:e.getSelectedByType(E.ChainType.EOSIO)})),p=(0,a.Fl)((()=>{var e;return null===(e=d.value)||void 0===e?void 0:e.getSelectedByType(E.ChainType.ETH)})),y=(0,a.Fl)((()=>{var e;return null===(e=g.value)||void 0===e?void 0:e.tokens[0].symbol})),I=(0,b.iH)(""),_=(0,b.iH)(),S=(0,b.iH)(void 0),q=(0,T.yj)(),B=q.query;if(Z.log("Bridge Options",B),B&&B.bridge&&B.eosio){S.value=!0;for(let o of r.value){if(o.eosio[0].contract==B.bridge)if(B.eosio.length<64){if(o.eosio[0].shortName==B.eosio){c.value=o,S.value=!1;break}}else if(o.eosio[0].chainHash==B.eosio){c.value=o,S.value=!1;break}if(!0===S.value){const o=t.value.find((e=>e.chainParams.shortName==B.eosio||e.chainParams.chainId==B.eosio));o&&(I.value=B.bridge,e.setSelectedConnect(o))}}if(c.value){B.from?(l.value.from=E.ChainType.ETH,l.value.to=E.ChainType.EOSIO):(l.value.from=E.ChainType.EOSIO,l.value.to=E.ChainType.ETH);let e=B.eth?B.eth:B.from?B.from:B.to?B.to:void 0;if(void 0!=e){let t=-1;t="number"==typeof e?c.value.eth.findIndex((t=>t.metamaskId==e)):c.value.eth.findIndex((t=>t.shortName==e)),-1!=t&&(c.value.selected.eth=t,f())}}}function U(e){var t;if(c.value){if(e!=(null===(t=p.value)||void 0===t?void 0:t.metamaskId)){const t=c.value.eth.findIndex((t=>t.metamaskId==e));-1!=t?(c.value.selected.eth=t,h()):w.Z.create({type:"negative",message:i("unavailableETHChain"),caption:i("unavailableETHChainDetail"),position:"top"})}de()}}const D=(0,b.iH)(0),z=(0,b.iH)(0),Q=(0,b.iH)(BigInt(0)),M=[e=>{if(void 0!=c.value&&y.value){let t=BigInt(0);if(l.value.from==E.ChainType.EOSIO){if(void 0==g.value||void 0==g.value.min)return!0;t=g.value.min}else{if(void 0==p.value||void 0==p.value.min)return!0;t=p.value.min}return t<=(0,x.StringToAmount)(e)||`${i("minIs")} ${(0,x.AmountToString)(t,y.value.precision)} ${y.value.name}`}return!0},()=>!P.value||i("someIsFreezed")],j=(0,a.Fl)((()=>{var e;return(null===(e=c.value)||void 0===e?void 0:e.fee)?BigInt(Math.floor(Number(Q.value)*c.value.fee.var))+c.value.fee.fix:BigInt(0)})),G=(0,a.Fl)((()=>{if(y.value&&j.value){const e=Q.value-j.value;return e>0?`${i("estimatedFeeOf")} ${(0,x.AssetToString)({amount:j.value,symbol:y.value})} ${i("resultsIn")} ${(0,x.AssetToString)({amount:e,symbol:y.value})}`:i("noAmountAfterTrans")}})),P=(0,a.Fl)((()=>{var e;return!!(null===(e=c.value)||void 0===e?void 0:e.freeze)&&(c.value.freeze.in||c.value.freeze.out||c.value.freeze.oracles||c.value.freeze.cancel)}));function L(e){return v.value.find((t=>{if(t.id==e.id&&t.chain.from==e.chain.from&&t.chain.to==e.chain.to)return!0}))}function R(e){const t=L(e);if(t)t.confirmations=e.confirmations,t.oracles=e.oracles,t.quantity=e.quantity,t.signatures=e.signatures,t.confirmed=e.confirmed,t.canceled=e.canceled;else{const t=v.value.findIndex((t=>t.date<=e.date));-1!=t?v.value.splice(t,0,e):v.value.push(e),te(e.id,K(e))}}function Y(e,t,o,a,l){let n=!1;if(t==E.ChainType.EOSIO){const t=(0,H.ethPublicKeyToTableFormat)(o.to);v.value.find((a=>{var i;if(1==K(a)){if(a.date<e)return!0;if(a.asset.symbol.precision==o.asset.symbol.precision&&a.asset.symbol.name==o.asset.symbol.name&&a.asset.amount<=o.asset.amount&&a.from==o.from&&a.to==t&&(null===(i=a.chain.to)||void 0===i?void 0:i.id)==l)return n=!0,!0}}))}else v.value.find((t=>{var i;if(0==K(t)){if(t.date<e)return!0;if(t.asset.symbol.precision==o.asset.symbol.precision&&o.asset.symbol.name==o.asset.symbol.name&&t.asset.amount==o.asset.amount&&t.to==o.to&&(a<2||(null===(i=t.chain.to)||void 0===i?void 0:i.id)==l))return n=!0,!0}}));return n}function K(e){var t,o;return(null===(t=e.chain.from)||void 0===t?void 0:t.type)==E.ChainType.EOSIO||(null===(o=e.chain.to)||void 0===o?void 0:o.type)==E.ChainType.ETH}const V=(0,b.iH)({eosio:void 0,eth:void 0});function J(e,t){return N(this,void 0,void 0,(function*(){try{if(_.value&&ae.value){if(!(e>=2))return yield _.value.claimed(String(t.id));if(t.chain.from)return yield _.value.isClaimed(String(t.chain.from.id),String(t.id))}}catch(o){Z.log(o,"object"==typeof o&&"message"in o?o.message:""),w.Z.create({type:"negative",message:i("errorOnRequestEth"),caption:String(o),position:"top"})}}))}function X(e,a){var l,n;return N(this,void 0,void 0,(function*(){if(ee.value||!_.value||!o.value||!o.value.name)return void Z.log(`loadTeleports ${String(ee.value)} || ethContract ${String(!_.value)} || walletUser ${String(!o.value)} || name ${String(!(null===(l=o.value)||void 0===l?void 0:l.name))}`);ee.value=!0;const i=o.value.name;if(Z.log("Get last teleports"),c.value){const o=c.value,l=(0,C.GetConnectByChainId)(o.eosio[0].chainHash,t.value);if(l){const t=yield(0,H.getTeleports)(l,o,i,e,a);for(let e of t)R(e);for(let e of v.value)if(!e.confirmed&&!e.canceled){if((null===(n=e.chain.to)||void 0===n?void 0:n.type)==E.ChainType.ETH){const t=yield J(o.version,e);if(Z.log("--------isClaimedOnETh",t),t){e.confirmed=!0,Z.log("--------confirmed so continue",t);continue}}Z.log("--------start updater"),(0,H.whileUpdateTeleport)(l,o,e)}}else w.Z.create({type:"negative",message:"Unknown chain",caption:`Chain hash: ${o.eosio[0].chainHash}`,position:"top"})}Z.log("Teleports",v.value),ee.value=!1}))}const ee=(0,b.iH)(!1);function te(e,t){t?(void 0==V.value.eosio||e>V.value.eosio)&&(V.value.eosio=e):(void 0==V.value.eth||e>V.value.eth)&&(V.value.eth=e)}const oe=(0,b.iH)(),ae=(0,b.iH)(!1);function le(e){Z.log("Set eth account",e),oe.value=e}function ne(){return N(this,void 0,void 0,(function*(){if(c.value&&p.value&&!1!==!p.value.statusChecked&&_.value)if(c.value.version<=1){void 0==p.value.min&&(p.value.min=BigInt(0));try{p.value.neededConfirms=Number((yield _.value.threshold()).valueOf()),p.value.statusChecked=!0}catch(e){Z.log("Can not get eth threshold",e)}}else try{p.value.min=BigInt((yield _.value.minteleport()).valueOf()),p.value.neededConfirms=Number((yield _.value.threshold()).valueOf()),p.value.statusChecked=!0}catch(e){Z.log("Can not get eth status",e)}}))}function ie(){return N(this,void 0,void 0,(function*(){return!(!ae.value||!p.value||null==p.value.metamaskId)&&(yield ne(),!!(yield(0,$.switchETHWalletNetwork)(p.value.metamaskId,!0))||(w.Z.create({position:"top",type:"negative",message:i("noSwitchEthChain"),caption:i("noSwitchEthChainInfo")}),Z.log("--switch sEthChain.value.metamaskId",p.value.metamaskId),Z.log("--switch ethChainId.value",n.value),!1))}))}function se(){return N(this,void 0,void 0,(function*(){p.value&&g.value&&(l.value.from===E.ChainType.EOSIO?yield ue(p.value.id):l.value.from===E.ChainType.ETH&&(yield re(g.value.id)),yield de(),yield ce())}))}function ue(e){return N(this,void 0,void 0,(function*(){D.value++,yield(()=>N(this,void 0,void 0,(function*(){var a,l;if(!(0,O.checkkEosioWalletAlerts)(o.value))return;const n=null===(a=o.value)||void 0===a?void 0:a.name;if(f(),!(yield ie())||!oe.value)return;if(!c.value)return;if(!y.value)return;Z.log("EOSIO teleport");const s=c.value,u={from:n,to:oe.value,asset:{amount:Q.value,symbol:y.value}};Z.log("ethAccount.value",oe.value);const r=(0,H.EosioTeleportTrx)(u,e,s.eosio[0],null===(l=o.value)||void 0===l?void 0:l.permission);if(!1===r)return!1;const d=w.Z.create({type:"ongoing",message:i("signTrx"),position:"top"}),v={isError:!1,notify:d},m=yield C.Connect.trySigning(v,o.value,r,{broadcast:!1});if(!(0,W.trxSigningErrorHandling)(v,m,i))return!1;yield X();let h=Math.floor(Date.now()/1e3);const g=(0,C.GetConnectByChainId)(s.eosio[0].chainHash,t.value);if(!g)return!1;if(!(yield(0,W.broadcastTrx)(v,g,m,i)))return!1;Z.log("Wait for EOSIO teleport");let p=!1,b=0;do{yield(0,H.sleep)(b<5?2e3:3e4);let t=Math.floor(Date.now()/1e3);yield X(H.GetTeleportType.eosio,{eosio:b<5?5:10}),p=Y(h,E.ChainType.EOSIO,u,s.version,e),h=t,b++}while(!p);Z.log("End waiting for EOSIO teleport")})))(),D.value--}))}function re(e){return N(this,void 0,void 0,(function*(){z.value++,yield(()=>N(this,void 0,void 0,(function*(){if(!c.value||!p.value||"number"!=typeof p.value.metamaskId)return void Z.log("No metamask id defined");if(!ae.value||!oe.value)return void Z.log("No eth account defined",ae.value);if(f(),!(yield ie())||!_.value)return;if("bigint"!=typeof Q.value||Q.value==BigInt(0)||!y.value)return void Z.log("Not valid asset");if(!o.value||!o.value.name)return void Z.log("No EOSIO user diefined");if(!g.value)return void Z.log("No eosio chain is selected");const a=c.value,l={from:oe.value,to:o.value.name,asset:{amount:Q.value,symbol:y.value}},n=(0,C.GetConnectByChainId)(a.eosio[0].chainHash,t.value);if(!n)return;if(!(yield n.checkAccountName(l.to))){const e=`The account ${l.to} seems not to exists on ${g.value.name} chain`;return Z.log(e),void w.Z.create({position:"top",type:"negative",message:e})}Z.log("Eth teleport to chain id",e),yield X();let i=Math.floor(Date.now()/1e3);Z.log(`Teleport an amount of ${Q.value} ${l.from?"from "+l.from:""} to ${l.to}`);try{Z.log(`teleport(${l.to}, ${Q.value.toString()}, ${g.value.id.toString()})`),yield _.value.teleport(l.to,Q.value.toString(),g.value.id.toString())}catch(u){return Z.log("Eth wallet error",u),void ge(u)}w.Z.create({position:"top",type:"positive",message:"Transaction send",caption:"Depending on the chain and gas fee, it may take some time until the tokens are transfered."}),Z.log("Wait for eth teleport");let s=!1;do{yield(0,H.sleep)(1e4);let t=Math.floor(Date.now()/1e3);yield X(H.GetTeleportType.eth,{eth:10}),s=Y(i,E.ChainType.ETH,l,a.version,e),i=t}while(!s);Z.log("End waiting for ETH teleport")})))(),z.value--}))}function de(){return N(this,void 0,void 0,(function*(){if(oe.value&&p.value&&!u.value.eth&&(f(),(yield ie())&&_.value)){u.value.eth=!0,s.value.eth=void 0;try{const e=yield _.value.balanceOf(oe.value);s.value.eth=e.toBigInt(),Z.log("balanceOf typeof",s.value.eth)}catch(e){Z.log("Error on getting eth balance",e)}finally{u.value.eth=!1}}}))}function ce(){return N(this,void 0,void 0,(function*(){if(!o.value||!o.value.name||!g.value)return;const e=(0,C.GetConnectByChainId)(g.value.chainHash,t.value);if(!e)return;if(u.value.eosio)return;u.value.eosio=!0,s.value.eosio=void 0;const a=g.value.tokens[0],l=yield e.get_currency_balance(a.contract,o.value.name,a.symbol.name);if(Z.log(`Balances of ${o.value.name}`,l),l&&"length"in l&&l.length>0){const e=(0,x.StringToAsset)(l[0]);if(!e||e.symbol.name!=a.symbol.name||e.symbol.precision!=a.symbol.precision)return void Z.log("Got worng token");s.value.eosio=e.amount}u.value.eosio=!1}))}function ve(){return N(this,void 0,void 0,(function*(){if(l.value&&s.value)switch(l.value.from){case E.ChainType.EOSIO:yield ce(),s.value.eosio&&(Q.value=s.value.eosio);break;case E.ChainType.ETH:yield de(),s.value.eth&&(Q.value=s.value.eth);break}}))}function me(){Z.log("Toogle direction");const e=l.value.from;l.value.from=l.value.to,l.value.to=e,h()}function he(e){ae.value=e.value,e.value&&de()}function fe(e){var o,a,l;return N(this,void 0,void 0,(function*(){if(oe.value)if(p.value&&c.value){if(f(),(yield ie())&&_.value)if(e.signatures){if((null===(o=e.chain.from)||void 0===o?void 0:o.type)==E.ChainType.EOSIO||(null===(a=e.chain.to)||void 0===a?void 0:a.type)==E.ChainType.ETH){if(!e.chain.to||null===(null===(l=e.chain.to)||void 0===l?void 0:l.metamaskId))return void Z.log("Wrong or no metamask id");if(Z.log("set to metamask id",e.chain.to.metamaskId),n.value=e.chain.to.metamaskId,!(yield ie()))return;try{const t=(0,H.teleportItemToSigData)(e.raw),o=c.value.version;let a,l;o>=2&&e.chain.from&&(a=e.chain.from.contract,l=(0,A.hexToUint8Array)(e.chain.from.chainHash.substring(0,8))),yield _.value.claim((0,H.createSigDataStr)({version:o,tel_contract:a,short_net_id:l},t),e.signatures)}catch(i){return void ge(i)}let o;if(!c.value)return;o=c.value,e.sendClaimed=!0,w.Z.create({position:"top",type:"positive",message:"Transaction send",caption:"Depending on the chain and gas fee, it may take some time until the tokens are transfered."});let a=0;yield(0,H.sleep)(3e3);do{const t=yield J(o.version,e);if(t)return e.confirmed=!0,void(yield de());yield(0,H.sleep)(1e4)}while(a<6);if(!e.confirmed&&!e.canceled){const a=(0,C.GetConnectByChainId)(o.eosio[0].chainHash,t.value);a&&(e.update.lastAction=Math.floor(Date.now()/1e3),(0,H.whileUpdateTeleport)(a,o,e))}}}else Z.log("No signatures available")}else Z.log("No ethereum chain selected");else Z.log("No ethereum account")}))}function ge(e){let t;Z.log("Eth wallet error",e),"object"==typeof e&&"reason"in e&&(t=String(e.reason)),w.Z.create({position:"top",type:"negative",message:"Wallet error while sending",caption:t})}function pe(e,t){c.value&&(e==E.ChainType.EOSIO?(c.value.selected.eosio=t,s.value.eosio=void 0):e==E.ChainType.ETH&&(c.value.selected.eth=t,s.value.eth=void 0),h())}function ye(){return N(this,void 0,void 0,(function*(){p.value&&(yield ie())&&(yield(0,$.addEthToken)(p.value.tokens[0]))}))}return(0,a.bv)((()=>{c.value?Z.log("-----Update bridge here?"):Z.log("-----No bridge defined on mounted"),o.value&&Z.log("-----Already connected on mounted")})),{direction:l,toggleDirection:me,loadingEosioTel:D,loadingEthTel:z,sendAmount:Q,sendRules:M,sSymbol:y,t:i,ethAccount:oe,ethChainId:n,bridges:r,sBridge:c,teleports:v,loadTeleports:ee,get_last_Teleports:X,showFinshed:m,sendTeleport:se,setEthAccount:le,ethConnected:ae,ethConnectChanged:he,sEosioChain:g,sEthChain:p,selectChain:pe,currentBalance:s,balanceLoading:u,selectMax:ve,eosioContractModel:I,claimClick:fe,getEthBalance:de,getEosioBalance:ce,customBridge:S,feeHint:G,walletUser:o,addToken:ye}}});var D=o(11639),z=o(69885),Q=o(44458),M=o(63190),j=o(68879),G=o(56362),P=o(13246),L=o(490),R=o(76749),Y=o(33115),K=o(22857),V=o(23175),J=o(98953),X=o(50926),ee=o(62146),te=o(69984),oe=o.n(te);const ae=(0,D.Z)(U,[["render",y]]),le=ae;oe()(U,"components",{QPage:z.Z,QCard:Q.Z,QCardSection:M.Z,QBtn:j.Z,QMenu:G.Z,QList:P.Z,QItem:L.Z,QItemSection:R.Z,QItemLabel:Y.Z,QIcon:K.Z,QToggle:V.Z,QSpinnerBox:J.Z,QSeparator:X.Z}),oe()(U,"directives",{ClosePopup:ee.Z})}}]);