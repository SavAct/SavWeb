"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[139],{27613:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ye});var l=o(59835),a=o(86970);const n={class:"row justify-between reverse q-mt-md"},i={class:"col-12 col-sm-5 col-md-4 q-px-sm"},s={class:"row justify-between"},r={class:"q-pr-sm text-h6 q-mb-sm"},u={class:"col-12 text-h6 text-left"},c={class:"col-12 text-left"},d={class:"q-gutter-sm"},m={key:0,class:"q-mt-sm"},p={class:"col-12 col-sm-7 col-md-8 row justify-center"},v={class:"row full-width"},y={class:"col q-pr-sm"},h={class:"q-mb-sm"},f={key:0},w={class:"text-no-wrap"},b={class:"q-mb-md"},g=(0,l._)("span",null,":  ",-1),T={class:"full-width"},_={key:1},q={class:"col-auto"},k=(0,l._)("br",null,null,-1),x={class:"full-width row flex-center q-gutter-sm"},C={class:"col q-pl-md"};function V(e,t,o,V,S,W){const U=(0,l.up)("q-btn"),z=(0,l.up)("q-btn-toggle"),I=(0,l.up)("q-icon"),H=(0,l.up)("q-card"),D=(0,l.up)("bar-graph"),P=(0,l.up)("pie-graph"),A=(0,l.up)("remaining-time"),Z=(0,l.up)("time-view"),F=(0,l.up)("trx-tool-tip"),O=(0,l.up)("q-avatar"),Q=(0,l.up)("q-td"),K=(0,l.up)("q-tr"),N=(0,l.up)("q-table"),B=(0,l.up)("symbol-dialog"),R=(0,l.up)("q-card-section"),j=(0,l.up)("q-card-actions"),E=(0,l.up)("q-dialog"),$=(0,l.up)("q-page"),M=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)($,{class:"justify-evenly",style:{position:"relative",height:"100%"}},{default:(0,l.w5)((()=>[(0,l._)("div",n,[(0,l._)("div",i,[(0,l.Wm)(H,{class:"card q-px-md q-pt-sm q-pb-md q-mb-md items-center"},{default:(0,l.w5)((()=>{var o,n;return[(0,l._)("div",s,[(0,l._)("div",r,(0,a.zw)(`${null===(n=null===(o=e.connect)||void 0===o?void 0:o.chainParams)||void 0===n?void 0:n.name} Network`),1),(0,l.Wm)(U,{size:"sm",class:"row q-px-sm q-py-none q-mb-md",onClick:t[0]||(t[0]=t=>e.showSymbol=!0),outline:""},{default:(0,l.w5)((()=>[(0,l._)("div",u,(0,a.zw)(e.symbol),1),(0,l._)("div",c,(0,a.zw)(e.tokenContract),1)])),_:1})]),(0,l._)("div",d,[(0,l._)("div",null,(0,a.zw)(e.t("graphTypeBy"))+":",1),(0,l.Wm)(z,{modelValue:e.switchCount,"onUpdate:modelValue":t[1]||(t[1]=t=>e.switchCount=t),class:"q-pa-none","no-caps":"",size:"sm",rounded:"",unelevated:"","toggle-color":"blue","text-color":"blue",style:{border:"1px solid #027be3"},options:[{label:e.t("fundingSum"),value:!1},{label:e.t("voteCount"),value:!0}]},null,8,["modelValue","options"]),(0,l.Wm)(I,{class:"cursor-pointer",size:"sm",name:"info",onClick:t[2]||(t[2]=t=>e.infoDialog=!0),clickable:""})]),e.hasUserTrx?((0,l.wg)(),(0,l.iD)("div",m,[(0,l._)("div",null,(0,a.zw)(e.t("voteFilter"))+":",1),(0,l.Wm)(z,{disable:!e.hasUserTrx,modelValue:e.activeFilter,"onUpdate:modelValue":t[3]||(t[3]=t=>e.activeFilter=t),class:"q-mt-sm","no-caps":"",size:"sm",rounded:"",unelevated:"","toggle-color":"blue","text-color":"blue",style:{border:"1px solid #027be3"},options:[{label:e.t("allVotes"),value:!1},{label:e.t("activeVotes"),value:!0}]},null,8,["disable","modelValue","options"])])):(0,l.kq)("",!0),(0,l.Wm)(z,{class:"q-mt-md full-width",modelValue:e.chartType,"onUpdate:modelValue":t[4]||(t[4]=t=>e.chartType=t),"toggle-color":"blue",options:[{value:"bar90",slot:"bar90"},{value:"bar",slot:"bar"},{value:"pie",slot:"pie"},{value:"donut",slot:"donut"}]},{bar90:(0,l.w5)((()=>[(0,l.Wm)(I,{name:"poll",style:{transform:"rotate(90deg)"}})])),bar:(0,l.w5)((()=>[(0,l.Wm)(I,{name:"poll"})])),pie:(0,l.w5)((()=>[(0,l.Wm)(I,{name:"pie_chart"})])),donut:(0,l.w5)((()=>[(0,l.Wm)(I,{name:"data_usage"})])),_:1},8,["modelValue"])]})),_:1})]),(0,l._)("div",p,["bar"==e.chartType||"bar90"==e.chartType?((0,l.wg)(),(0,l.j4)(D,{class:"q-mx-sm",data:e.voteData,key:e.graphUpdateKey[0],switchCount:e.switchCount,symbol:e.symbol,precision:e.precision,horizontal:"bar90"==e.chartType},null,8,["data","switchCount","symbol","precision","horizontal"])):"pie"==e.chartType||"donut"==e.chartType?((0,l.wg)(),(0,l.j4)(P,{class:"q-mx-sm",data:e.voteData,key:e.graphUpdateKey[1],switchCount:e.switchCount,symbol:e.symbol,precision:e.precision,donut:"donut"==e.chartType},null,8,["data","switchCount","symbol","precision","donut"])):(0,l.kq)("",!0)])]),(0,l.Wm)(N,{title:"Incomings",class:"q-mx-sm q-mb-md q-mt-sm card",rows:e.inRows,columns:e.inColumns,"row-key":e.rowKey,color:"amber",loading:e.loadingUpdateIn,"no-data-label":"Enter user accounts and click the update button to show data"},{top:(0,l.w5)((()=>[(0,l._)("div",v,[(0,l._)("div",y,[(0,l._)("div",h,[(0,l.Wm)(I,{class:"text-h6",name:"start"}),(0,l._)("span",{class:(0,a.C_)(e.user.length<=13?"text-h6":"text-subtitle2")},(0,a.zw)(e.$q.screen.gt.xs?e.user:e.shrinkText(e.user,40)),3)]),e.hasUserTrx?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[e.isVoteOver?void 0!==e.limit?((0,l.wg)(),(0,l.iD)("div",_,[(0,l._)("span",null,(0,a.zw)(e.t("punishLimit"))+":  ",1),(0,l.Wm)(A,{modelValue:e.limit,"onUpdate:modelValue":t[7]||(t[7]=t=>e.limit=t),timeOverMsg:e.t("voteResultTimeEnd"),onTimeover:t[8]||(t[8]=t=>e.isTimeover=!0)},null,8,["modelValue","timeOverMsg"])])):(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",f,[(0,l._)("span",w,(0,a.zw)(e.t("voteEndTime")),1),(0,l._)("span",b,[g,(0,l.Wm)(A,{modelValue:e.voteEnd,"onUpdate:modelValue":t[5]||(t[5]=t=>e.voteEnd=t),timeOverMsg:e.t("timeIsOver"),onTimeover:t[6]||(t[6]=t=>e.isVoteOver=!0)},null,8,["modelValue","timeOverMsg"])]),(0,l._)("div",T,[(0,l._)("span",null,(0,a.zw)(e.t("punishTimeSpanSend"))+":  ",1),(0,l.Wm)(Z,{class:"col",showTime:e.decisionTime,valueClasses:"text-green"},null,8,["showTime"])])]))],64)):(0,l.kq)("",!0)]),(0,l._)("div",q,[(0,l.Wm)(U,{icon:"update",label:"In",loading:e.loadingUpdateIn,outline:"",onClick:t[9]||(t[9]=t=>e.updateIn()),disable:e.loadingUpdateIn},null,8,["loading","disable"])])])])),body:(0,l.w5)((t=>[(0,l.Wm)(K,{props:t,class:(0,a.C_)(["cursor-pointer",t.row.removed?e.brightStyle?"bg-grey":"bg-grey-10":""]),onClick:o=>e.onRowClick(t.row,!0)},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{trx:t.row},null,8,["trx"]),(0,l.Wm)(Q,{key:"type",props:t},{default:(0,l.w5)((()=>[(0,l.Wm)(O,{"text-color":"black",size:"md",color:e.colorStatus(t.row.time),icon:0==t.row.type?"shopping_cart":"poll"},null,8,["color","icon"])])),_:2},1032,["props"]),(0,l.Wm)(Q,{key:"id",props:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t.row.id),1)])),_:2},1032,["props"]),(0,l.Wm)(Q,{key:"sender",props:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.shortAddress(t.row.sender)),1)])),_:2},1032,["props"]),(0,l.Wm)(Q,{key:"fund",props:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t.row.orifund),1),k,(0,l.Uk)((0,a.zw)(t.row.contract),1)])),_:2},1032,["props"]),(0,l.Wm)(Q,{key:"vote",props:t,style:(0,a.j5)(`color: ${e.VoteColor[t.row.vote.choice.selected]}`)},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t.row.vote?(t.row.vote.choice.selected+1).toString():""),1)])),_:2},1032,["props","style"]),(0,l.Wm)(Q,{key:"option",props:t},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(t.row.vote?e.shortenText(t.row.vote.choice.msg):t.row.memo),1)])),_:2},1032,["props"])])),_:2},1032,["props","class","onClick"])])),"no-data":(0,l.w5)((({message:e})=>[(0,l._)("div",x,[(0,l._)("span",null,(0,a.zw)(e),1)])])),_:1},8,["rows","columns","row-key","loading"]),(0,l.Wm)(B,{modelValue:e.showSymbol,"onUpdate:modelValue":t[10]||(t[10]=t=>e.showSymbol=t),contract:e.tokenContract,"onUpdate:contract":t[11]||(t[11]=t=>e.tokenContract=t),symbol:e.symbol,"onUpdate:symbol":t[12]||(t[12]=t=>e.symbol=t),connect:e.connect,precision:e.precision,"onUpdate:precision":t[13]||(t[13]=t=>e.precision=t)},null,8,["modelValue","contract","symbol","connect","precision"]),(0,l.Wm)(E,{modelValue:e.infoDialog,"onUpdate:modelValue":t[14]||(t[14]=t=>e.infoDialog=t)},{default:(0,l.w5)((()=>[(0,l.Wm)(H,null,{default:(0,l.w5)((()=>[(0,l.Wm)(R,{class:"q-pb-none row"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{class:"col-auto",name:"info",size:"lg"}),(0,l._)("span",C,(0,a.zw)(e.t("voteResultInfo")),1)])),_:1}),(0,l.Wm)(j,{class:"q-pt-none",align:"right"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(U,{flat:"",label:"OK",color:"primary"},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var S=o(60499),W=o(80217),U=o(52086),z=o(50674),I=o(72902),H=o(47045),D=o(89889),P=o(27712),A=o(6827),Z=o(62659),F=o(94345),O=o(7580),Q=o(65211),K=o(53103),N=o(74544),B=o(28339),R=o(10818),j=o(3390),E=o(5980),$=o(47983),M=o(86350),G=o(17779),L=function(e,t,o,l){function a(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,n){function i(e){try{r(l.next(e))}catch(t){n(t)}}function s(e){try{r(l["throw"](e))}catch(t){n(t)}}function r(e){e.done?o(e.value):a(e.value).then(i,s)}r((l=l.apply(e,t||[])).next())}))};const Y=(0,l.aZ)({name:"page-vote",components:{TrxToolTip:W["default"],PieGraph:U["default"],BarGraph:z["default"],SymbolDialog:I["default"],RemainingTime:H["default"],TimeView:D["default"]},setup(){const e=(0,j.b)(),t=(0,Z.r)(),o=(0,P.QT)({useScope:"global"}).t.bind(this),a=(0,B.tv)(),n=(0,B.yj)(),i=n.query,s=(0,S.iH)("bar90"),r=(0,S.iH)(!1),u=(0,S.iH)(!1),c=(0,S.iH)(!1),d=(0,l.Fl)({get:()=>c.value,set:e=>{c.value=e,u.value=!1}}),m=(0,S.iH)(!1),p=(0,S.iH)(!1),v=(0,S.iH)([0,0]),y=(0,S.iH)(!1),h=(0,S.iH)("SAVACT"),f=(0,S.iH)("token.savact"),w=(0,S.iH)(4),b=(0,E.GetConnectByChainId)(i.chain,t.allConnects),g=(0,S.iH)("string"==typeof i.to?i.to:t.historyUserInput?t.historyUserInput:""),T=(0,l.Fl)({get:()=>g.value,set:e=>{g.value=e,((0,F.isNameValid)(e)||e.length>52&&Q.b.isValidPublic(e))&&t.setHistoryUserInput(e)}}),_=Number(i.id);function q(){var e;const o=null===(e=t.user[T.value])||void 0===e?void 0:e.inHistory.find((e=>0!=e.type&&e.id==_));if(!o)return;const l=(0,N.stringToAsset)(o.fund);f.value=o.contract,h.value=l.symbol.name,w.value=l.symbol.precision;const a=Date.now()/1e3;return o.time>a?d.value=!1:o.time>1&&(d.value=!0),o.vote&&o.vote.end>a?m.value=!1:o.time>1&&(m.value=!0),o}"number"!=typeof _&&G.log("Error: Missing id in query",_);const k=(0,S.iH)(q()),x=(0,l.Fl)((()=>void 0!=k.value)),C=(0,l.Fl)((()=>{if(k.value)return new Date(1e3*k.value.time)})),V=(0,l.Fl)((()=>k.value&&k.value.vote?new Date(1e3*k.value.vote.end):void 0)),W=(0,l.Fl)((()=>C.value&&V.value?(C.value.getTime()-V.value.getTime())/1e3:void 0));function U(){return L(this,void 0,void 0,(function*(){yield ee(),k.value||(k.value=q())}))}const z=(0,S.iH)(t.historyRecipientInput?t.historyRecipientInput:""),I=(0,l.Fl)({get:()=>z.value,set:e=>{z.value=e,((0,F.isNameValid)(e)||e.length>52&&Q.b.isValidPublic(e))&&t.setHistoryRecipientInput(e)}}),H=(0,l.Fl)((()=>e.brightStyle)),D=(0,S.iH)(!1),Y=(0,S.iH)(!1),J=(0,S.iH)(-1);function X(e){var l,a;return L(this,void 0,void 0,(function*(){if(!b)return A.Z.create({type:"negative",message:o("noChainDefined"),position:"top"}),!1;try{let n=!0,i=0;const s=200;while(n){const r=Date.now();if((0,F.isNameValid)(e)){const o=yield b.get_table_rows({code:b.chainParams.savpayContract,table:"pay2name",scope:e,lower_bound:String(i),limit:s,reverse:!0});if(o.rows.length>0)for(const a of o.rows){const o=null===(l=(0,F.StringToAsset)(a.fund))||void 0===l?void 0:l.symbol;void 0!=o&&t.updateHistoryInTrx(e,{sender:(0,O.hexTypeOfPubKeyToNameOrKeyStr)(a.from),recipient:e,id:a.id,fund:a.fund,orifund:(0,F.AssetToString)({amount:a.orisent,symbol:o}),memo:a.memo,ramBy:a.ramBy,type:a.type,time:a.time,contract:a.contract,lastUpdate:r,removed:!1,chain:b.chainParams.shortName?b.chainParams.shortName:b.chainParams.chainId})}n=o.more}else{if(!Q.b.isValidPublic(e))return A.Z.create({type:"negative",message:e.length<13?o("invalidAcc"):o("invalidPub"),position:"top"}),!1;{const o=K.PublicKey.fromString(e),l=(0,O.splitPubKeyToScopeAndTableVec)(o);e=e.toString();const u=yield b.get_table_rows({code:b.chainParams.savpayContract,table:"pay2key",scope:l.scope.toString(),lower_bound:String(i),limit:s,reverse:!0});if(u.rows.length>0)for(const n of u.rows){const o=null===(a=(0,F.StringToAsset)(n.fund))||void 0===a?void 0:a.symbol;void 0!=o&&t.updateHistoryInTrx(e,{sender:(0,O.hexTypeOfPubKeyToNameOrKeyStr)(n.from),recipient:e,id:n.id,fund:n.fund,orifund:(0,F.AssetToString)({amount:n.orisent,symbol:o}),memo:n.memo,ramBy:n.ramBy,type:n.type,time:n.time,contract:n.contract,lastUpdate:r,removed:!1,chain:b.chainParams.shortName?b.chainParams.shortName:b.chainParams.chainId})}n=u.more}}i+=s,yield(0,N.sleep)(1e3)}}catch(n){return G.log("Error on requesting data",n),!1}return!0}))}function ee(){return L(this,void 0,void 0,(function*(){if(D.value)return;const e=T.value;e?D.value||(D.value=!0,yield X(e),D.value=!1):A.Z.create({type:"negative",message:o("noSenderDefined"),caption:o("enterUserFirst"),position:"top"})}))}const te=(0,l.Fl)((()=>[{name:"type",align:"left",label:"",field:"type"},{name:"id",align:"left",label:"Id",field:"id",sortable:!0},{name:"sender",align:"left",label:o("sender"),field:"sender",sortable:!0},{name:"fund",align:"left",label:o("fund"),field:"fund",sortable:!0},{name:"vote",align:"left",label:o("selection"),field:"vote"},{name:"option",align:"left",label:"Option",field:"option"}])),oe=(0,l.Fl)((()=>t.user[T.value]&&x.value?t.user[T.value].inHistory.filter((e=>le(e))):[]));function le(e){if(k.value&&k.value.vote)return!(!e.vote||e.chain!=k.value.chain||e.contract!=k.value.contract||e.vote.id!=k.value.vote.id||e.vote.end!=k.value.vote.end||e.vote.total!=k.value.vote.total||!(e.time==k.value.time||e.time<=1))}function ae(e,t){let o=t?{user:e.recipient,from:e.sender,id:e.id,chain:e.chain}:{user:e.sender,to:e.recipient,id:e.id,chain:e.chain};a.push({name:"action",query:o})}function ne(e){return`${e.sender} ${e.recipient} ${e.id}`}const ie=(0,l.Fl)((()=>{if(k.value&&k.value.vote&&!(k.value.vote.total<=0)){if(r.value){let e=Array(k.value.vote.total).fill(0),t=new Set;for(let o of oe.value)if(o.vote&&!t.has(o.sender+o.vote.choice.selected)&&o.contract==f.value){const l=(0,N.stringToAsset)(o.fund);if(l.symbol.name==h.value&&l.symbol.precision==w.value){if(u.value&&o.time<=1)continue;e[o.vote.choice.selected]++,t.add(o.sender+o.vote.choice.selected)}}return e}{let e=Array(k.value.vote.total).fill(BigInt(0));for(let t of oe.value)if(t.contract==f.value){const o=(0,N.stringToAsset)(t.fund);if(o.symbol.name==h.value&&o.symbol.precision==w.value&&t.vote){if(u.value&&t.time<=1)continue;e[t.vote.choice.selected]+=o.amount}}return e.map((e=>Number(e)))}}}));return U(),{t:o,brightStyle:H,user:T,to:I,moreAvailable:Y,lastSearchId:J,updateIn:ee,loadingUpdateIn:D,eosioStore:t,showWalletDialog:t.showWalletDialog,inColumns:te,inRows:oe,shortAddress:F.shortAddress,shortenText:F.shortenText,onRowClick:ae,rowKey:ne,colorStatus:R.colorStatus,showSymbol:y,connect:b,tokenContract:f,symbol:h,precision:w,voteData:ie,switchCount:r,graphUpdateKey:v,VoteColor:$.VoteColor,limit:C,activeFilter:u,isTimeover:d,isVoteOver:m,hasUserTrx:x,infoDialog:p,voteEnd:V,decisionTime:W,shrinkText:M.shrinkText,chartType:s}}});var J=o(11639),X=o(69885),ee=o(44458),te=o(68879),oe=o(1389),le=o(22857),ae=o(77580),ne=o(31233),ie=o(67220),se=o(61357),re=o(32074),ue=o(63190),ce=o(11821),de=o(62146),me=o(69984),pe=o.n(me);const ve=(0,J.Z)(Y,[["render",V]]),ye=ve;pe()(Y,"components",{QPage:X.Z,QCard:ee.Z,QBtn:te.Z,QBtnToggle:oe.Z,QIcon:le.Z,QTable:ae.Z,QTr:ne.Z,QTd:ie.Z,QAvatar:se.Z,QDialog:re.Z,QCardSection:ue.Z,QCardActions:ce.Z}),pe()(Y,"directives",{ClosePopup:de.Z})}}]);