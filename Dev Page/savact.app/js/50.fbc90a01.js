"use strict";(globalThis["webpackChunksavactapp"]=globalThis["webpackChunksavactapp"]||[]).push([[50],{50:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Y});var n=o(59835),i=o(86970),a=o(61957);const r={class:"row q-pt-md q-pb-sm q-px-md"},l={class:"col-auto q-ml-sm"},s={class:"col q-pr-sm"},c={class:"col-auto"},d=(0,n._)("br",null,null,-1),u=(0,n._)("br",null,null,-1),p={class:"full-width row flex-center q-gutter-sm"},m={class:"col q-pr-sm"},y={class:"col-auto q-pr-sm"},f={class:"col-auto"},g=(0,n._)("br",null,null,-1),w=(0,n._)("br",null,null,-1),h={class:"row justify-center items-center full-width"},v={class:"full-width row flex-center q-gutter-sm"};function b(e,t,o,b,k,_){const S=(0,n.up)("q-btn"),U=(0,n.up)("q-input"),P=(0,n.up)("q-tooltip"),T=(0,n.up)("trx-tool-tip"),C=(0,n.up)("q-avatar"),I=(0,n.up)("q-td"),x=(0,n.up)("q-tr"),W=(0,n.up)("q-table"),H=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(H,{class:"items-center justify-evenly",style:{position:"relative",height:"100%"}},{default:(0,n.w5)((()=>{var o;return[(0,n._)("div",r,[(0,n._)("div",{class:(0,i.C_)(["col",e.$q.screen.gt.xs?"text-h5":"text-h6"])},"SavAct Payments",2),(0,n._)("div",l,[(0,n.Wm)(S,{class:"col-auto q-ml-sm",label:`${null===(o=e.chain)||void 0===o?void 0:o.name} Network`,onClick:e.showWalletDialog,outline:""},null,8,["label","onClick"])])]),(0,n.Wm)(W,{title:"Incommings",class:"q-mx-sm card",rows:e.inRows,columns:e.inColumns,"row-key":e.rowKey,color:"amber",loading:e.loadingUpdateIn,"no-data-label":e.t("hintHistoryUse")},{top:(0,n.w5)((()=>[(0,n._)("div",s,[(0,n.Wm)(U,{modelValue:e.user,"onUpdate:modelValue":t[0]||(t[0]=t=>e.user=t),dense:"",type:"text",label:e.t("recipient"),onKeydown:t[1]||(t[1]=(0,a.D2)((t=>e.updateIn()),["enter"]))},null,8,["modelValue","label"])]),(0,n._)("div",c,[(0,n.Wm)(S,{icon:"update",label:"In",loading:e.loadingUpdateIn,outline:"",onClick:t[2]||(t[2]=t=>e.updateIn()),disable:e.loadingUpdateIn},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("update")),1)])),_:1})])),_:1},8,["loading","disable"])])])),body:(0,n.w5)((t=>[(0,n.Wm)(x,{props:t,class:(0,i.C_)(["cursor-pointer",t.row.removed?e.brightStyle?"bg-grey":"bg-grey-10":""]),onClick:o=>e.onRowClick(t.row,!0)},{default:(0,n.w5)((()=>[(0,n.Wm)(T,{trx:t.row},null,8,["trx"]),(0,n.Wm)(I,{key:"type",props:t},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{"text-color":"black",size:"md",color:e.colorStatus(t.row.time),icon:0==t.row.type?"shopping_cart":"poll"},null,8,["color","icon"])])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"id",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.id),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"sender",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortAddress(t.row.sender)),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"fund",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.orifund),1),d,(0,n.Uk)((0,i.zw)(t.row.contract),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"time",props:t},{default:(0,n.w5)((()=>[t.row.time>1?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleTimeString()),1),u,(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleDateString()),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)("-")],64))])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"memo",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortenText(t.row.memo)),1)])),_:2},1032,["props"])])),_:2},1032,["props","class","onClick"])])),"no-data":(0,n.w5)((({message:e})=>[(0,n._)("div",p,[(0,n._)("span",null,(0,i.zw)(e),1)])])),_:1},8,["rows","columns","row-key","loading","no-data-label"]),(0,n.Wm)(W,{title:"Outgoings",class:"q-mx-sm q-my-md card",rows:e.outRows,columns:e.outColumns,"row-key":e.rowKey,color:"amber",loading:e.loadingUpdateOut,"no-data-label":e.t("hintHistoryUse")},{top:(0,n.w5)((()=>[(0,n._)("div",m,[(0,n.Wm)(U,{modelValue:e.to,"onUpdate:modelValue":t[3]||(t[3]=t=>e.to=t),dense:"",type:"text",label:e.t("sender"),onKeydown:t[4]||(t[4]=(0,a.D2)((t=>e.search(0)),["enter"]))},null,8,["modelValue","label"])]),(0,n._)("div",y,[(0,n.Wm)(S,{icon:"search",outline:"",onClick:t[5]||(t[5]=t=>e.search(0)),disable:e.loadingSearch||e.loadingUpdateOut},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("searchDeeper")),1)])),_:1})])),_:1},8,["disable"])]),(0,n._)("div",f,[(0,n.Wm)(S,{icon:"update",label:"Out",loading:e.loadingUpdateOut,outline:"",onClick:t[6]||(t[6]=t=>e.updateOut()),disable:e.loadingSearch||e.loadingUpdateOut},{default:(0,n.w5)((()=>[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.t("update")),1)])),_:1})])),_:1},8,["loading","disable"])])])),body:(0,n.w5)((t=>[(0,n.Wm)(x,{props:t,class:(0,i.C_)(["cursor-pointer",t.row.removed?e.brightStyle?"bg-grey":"bg-grey-10":""]),onClick:o=>e.onRowClick(t.row,!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(T,{trx:t.row},null,8,["trx"]),(0,n.Wm)(I,{key:"type",props:t},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{"text-color":"black",size:"md",color:e.colorStatus(t.row.time),icon:0==t.row.type?"shopping_cart":"poll"},null,8,["color","icon"])])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"nr",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.nr),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"recipient",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortAddress(t.row.recipient)),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"fund",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.row.orifund),1),g,(0,n.Uk)((0,i.zw)(t.row.contract),1)])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"time",props:t},{default:(0,n.w5)((()=>[t.row.time>1?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleTimeString()),1),w,(0,n.Uk)((0,i.zw)(new Date(1e3*t.row.time).toLocaleDateString()),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)("-")],64))])),_:2},1032,["props"]),(0,n.Wm)(I,{key:"memo",props:t},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.shortenText(t.row.memo)),1)])),_:2},1032,["props"])])),_:2},1032,["props","class","onClick"])])),bottom:(0,n.w5)((()=>[(0,n._)("div",h,[e.moreAvailable?((0,n.wg)(),(0,n.j4)(S,{key:0,icon:"add_circle_outline",loading:e.loadingSearch,round:"",onClick:t[7]||(t[7]=t=>e.search(e.lastSearchId)),disable:e.loadingSearch||e.loadingUpdateOut},null,8,["loading","disable"])):(0,n.kq)("",!0)])])),"no-data":(0,n.w5)((({message:e})=>[(0,n._)("div",v,[(0,n._)("span",null,(0,i.zw)(e),1)])])),_:1},8,["rows","columns","row-key","loading","no-data-label"])]})),_:1})}var k=o(60499),_=o(80217),S=o(27712),U=o(6827),P=o(62659),T=o(94345),C=o(7580),I=o(65211),x=o(53103),W=o(74544),H=o(28339),q=o(10818),A=o(3390),D=o(17779),V=function(e,t,o,n){function i(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,a){function r(e){try{s(n.next(e))}catch(t){a(t)}}function l(e){try{s(n["throw"](e))}catch(t){a(t)}}function s(e){e.done?o(e.value):i(e.value).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const Z=(0,n.aZ)({name:"page-history",components:{TrxToolTip:_["default"]},setup(){var e;const t=(0,A.b)(),o=(0,P.r)(),i=(0,S.QT)({useScope:"global"}).t.bind(this),a=(0,H.tv)(),r=(0,n.Fl)((()=>t.brightStyle));!o.historyUserInput&&(null===(e=o.walletUser)||void 0===e?void 0:e.name)&&o.setHistoryUserInput(o.walletUser.name);const l=(0,k.iH)(o.historyUserInput?o.historyUserInput:""),s=(0,n.Fl)({get:()=>l.value,set:e=>{l.value=e,e.length<=13&&(e=e.toLowerCase()),(0,T.isNameValid)(e)||e.length>52&&I.b.isValidPublic(e)?o.setHistoryUserInput(e):o.setHistoryUserInput(void 0)}}),c=(0,n.Fl)((()=>o.historyUserInput.length>13?x.PublicKey.fromString(o.historyUserInput).toString():o.historyUserInput)),d=(0,k.iH)(o.historyRecipientInput?o.historyRecipientInput:""),u=(0,n.Fl)({get:()=>d.value,set:e=>{d.value=e,e.length<=13&&(e=e.toLowerCase()),((0,T.isNameValid)(e)||e.length>52&&I.b.isValidPublic(e))&&o.setHistoryRecipientInput(e)}}),p=(0,n.Fl)((()=>o.historyRecipientInput.length>13?x.PublicKey.fromString(o.historyRecipientInput).toString():o.historyRecipientInput)),m=(0,k.iH)(!1),y=(0,k.iH)(!1),f=(0,k.iH)(!1),g=(0,k.iH)(!1),w=(0,k.iH)(-1),h=(0,n.Fl)((()=>{var e;return null===(e=o.selectedConnect)||void 0===e?void 0:e.chainParams}));function v(e){var t,n;return V(this,void 0,void 0,(function*(){const a=c.value;if(!a)return void U.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"});const r=p.value;if(!r)return void U.Z.create({type:"negative",message:i("noRecipientDefined"),caption:i("enterRecipientFirst"),position:"top"});const l=o.selectedConnect;if(!l)return void U.Z.create({type:"negative",message:i("noChainDefined"),position:"top"});if(m.value)return;let s;if(m.value=!0,(0,T.isNameValid)(a))s=(0,C.nameToFromHex)(a);else{if(!I.b.isValidPublic(a))return U.Z.create({type:"negative",message:a.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),void(m.value=!1);s=(0,C.hexWithTypeOfPubKey)(x.PublicKey.fromString(a))}const d=200,u=Date.now();try{if((0,T.isNameValid)(r)){const n=yield l.get_table_rows({code:l.chainParams.savpayContract,table:"pay2name",scope:r,lower_bound:String(e),limit:d});if(n.rows.length>0)for(const e of n.rows)if(s==e.from){const n=null===(t=(0,T.StringToAsset)(e.fund))||void 0===t?void 0:t.symbol;if(void 0==n)continue;o.updateHistoryOutTrx(a,{sender:a,recipient:r,id:e.id,fund:e.fund,orifund:(0,T.AssetToString)({amount:e.orisent,symbol:n}),memo:e.memo,ramBy:e.ramBy,type:e.type,time:e.time,contract:e.contract,lastUpdate:u,removed:!1,chain:l.chainParams.shortName?l.chainParams.shortName:l.chainParams.chainId})}g.value=n.more}else if(I.b.isValidPublic(r)){const t=x.PublicKey.fromString(r),c=(0,C.splitPubKeyToScopeAndTableVec)(t),p=yield l.get_table_rows({code:l.chainParams.savpayContract,table:"pay2key",scope:c.scope.toString(),limit:200,reverse:!0});if(!(p.rows.length>0))return U.Z.create({type:"negative",message:a.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),void(m.value=!1);for(const e of p.rows)if(e.to==c.tableVec&&s==e.from){const t=null===(n=(0,T.StringToAsset)(e.fund))||void 0===n?void 0:n.symbol;if(void 0==t)continue;o.updateHistoryOutTrx(a,{sender:a,recipient:r,id:e.id,fund:e.fund,orifund:(0,T.AssetToString)({amount:e.orisent,symbol:t}),memo:e.memo,ramBy:e.ramBy,type:e.type,time:e.time,contract:e.contract,lastUpdate:u,removed:!1,chain:l.chainParams.shortName?l.chainParams.shortName:l.chainParams.chainId})}const y=e,f=e+d;o.user[a].outHistory.forEach(((e,t)=>{e.lastUpdate!=u&&e.id>=y&&e.id<y&&o.markRemovedOutTrx(a,t)})),w.value=f,g.value=p.more}else U.Z.create({type:"negative",message:r.length<13?i("invalidAcc"):i("invalidPub"),position:"top"})}catch(y){D.log("Error on requesting data",y)}finally{m.value=!1}}))}function b(e){var t,n;return V(this,void 0,void 0,(function*(){const a=o.selectedConnect;if(!a)return U.Z.create({type:"negative",message:i("noChainDefined"),position:"top"}),!1;try{let r=!0,l=0;const s=200;while(r){const c=Date.now();if((0,T.isNameValid)(e)){const n=yield a.get_table_rows({code:a.chainParams.savpayContract,table:"pay2name",scope:e,lower_bound:String(l),limit:s,reverse:!0});if(n.rows.length>0)for(const i of n.rows){const n=null===(t=(0,T.StringToAsset)(i.fund))||void 0===t?void 0:t.symbol;void 0!=n&&o.updateHistoryInTrx(e,{sender:(0,C.hexTypeOfPubKeyToNameOrKeyStr)(i.from),recipient:e,id:i.id,fund:i.fund,orifund:(0,T.AssetToString)({amount:i.orisent,symbol:n}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:c,removed:!1,chain:a.chainParams.shortName?a.chainParams.shortName:a.chainParams.chainId})}r=n.more}else{if(!I.b.isValidPublic(e))return U.Z.create({type:"negative",message:e.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),!1;{const t=x.PublicKey.fromString(e),i=(0,C.splitPubKeyToScopeAndTableVec)(t);e=t.toString();const d=yield a.get_table_rows({code:a.chainParams.savpayContract,table:"pay2key",scope:i.scope.toString(),lower_bound:String(l),limit:s,reverse:!0});if(d.rows.length>0)for(const r of d.rows){const t=null===(n=(0,T.StringToAsset)(r.fund))||void 0===n?void 0:n.symbol;void 0!=t&&o.updateHistoryInTrx(e,{sender:(0,C.hexTypeOfPubKeyToNameOrKeyStr)(r.from),recipient:e,id:r.id,fund:r.fund,orifund:(0,T.AssetToString)({amount:r.orisent,symbol:t}),memo:r.memo,ramBy:r.ramBy,type:r.type,time:r.time,contract:r.contract,lastUpdate:c,removed:!1,chain:a.chainParams.shortName?a.chainParams.shortName:a.chainParams.chainId})}r=d.more}}l+=s,yield(0,W.sleep)(1e3)}}catch(r){return D.log("Error on requesting data",r),!1}return!0}))}function _(e){var t;return V(this,void 0,void 0,(function*(){const n=o.selectedConnect;if(!n)return U.Z.create({type:"negative",message:i("noChainDefined"),position:"top"}),!1;const a=Date.now();try{if(!o.user[e]||!o.user[e].outHistory||o.user[e].outHistory.length<=0)return U.Z.create({type:"negative",message:i("noOutHistory"),position:"top"}),!1;for(const r of o.user[e].outHistory)if(!r.removed){let l,s,c="",d=!1;if((0,T.isNameValid)(r.recipient))l="pay2name",s=e;else{if(!I.b.isValidPublic(r.recipient))return U.Z.create({type:"negative",message:r.recipient.length<13?i("invalidAcc"):i("invalidPub"),position:"top"}),!1;{d=!0;const e=x.PublicKey.fromString(r.recipient),t=(0,C.splitPubKeyToScopeAndTableVec)(e);l="pay2key",s=String(t.scope),c=t.tableVec}}const u=yield n.get_table_rows({code:n.chainParams.savpayContract,table:l,scope:s,lower_bound:String(r.id),upper_bound:String(r.id),reverse:!0});if(!("rows"in u&&u.rows.length>0))return!1;{const i=u.rows[0];if(d&&c!=i.to)return!1;const l=null===(t=(0,T.StringToAsset)(i.fund))||void 0===t?void 0:t.symbol;if(void 0==l)continue;o.updateHistoryOutTrx(e,{sender:e,recipient:r.recipient,id:i.id,fund:i.fund,orifund:(0,T.AssetToString)({amount:i.orisent,symbol:l}),memo:i.memo,ramBy:i.ramBy,type:i.type,time:i.time,contract:i.contract,lastUpdate:a,removed:!1,chain:n.chainParams.shortName?n.chainParams.shortName:n.chainParams.chainId})}}}catch(r){return D.log("Error on requesting data",r),!1}return!0}))}function Z(){return V(this,void 0,void 0,(function*(){const e=c.value;e?y.value||(y.value=!0,yield b(e),y.value=!1):U.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"})}))}function z(){return V(this,void 0,void 0,(function*(){const e=c.value;e?f.value||(f.value=!0,yield _(e),f.value=!1):U.Z.create({type:"negative",message:i("noSenderDefined"),caption:i("enterUserFirst"),position:"top"})}))}o.iniHistory(c.value);const O=[{name:"type",align:"left",label:"",field:"type"},{name:"id",align:"left",label:"Id",field:"id",sortable:!0},{name:"sender",align:"left",label:i("sender"),field:"sender",sortable:!0},{name:"fund",align:"left",label:i("fund"),field:"fund",sortable:!0},{name:"time",align:"center",label:i("deadline"),field:"time",sortable:!0},{name:"memo",align:"left",label:"Memo",field:"memo"}],K=[{name:"type",align:"left",label:"",field:"type"},{name:"nr",align:"left",label:"Local nr.",field:"nr",sortable:!0},{name:"recipient",align:"left",label:i("recipient"),field:"recipient"},{name:"fund",align:"left",label:i("fund"),field:"fund",sortable:!0},{name:"time",align:"center",label:i("deadline"),field:"time",sortable:!0},{name:"memo",align:"left",label:"Memo",field:"memo"}],N=(0,n.Fl)((()=>o.user[c.value]?o.user[c.value].inHistory:[])),R=(0,n.Fl)((()=>o.user[c.value]?o.user[c.value].outHistory:[]));function F(e,t){let o=t?{user:e.recipient,from:e.sender,id:e.id,chain:e.chain}:{user:e.sender,to:e.recipient,id:e.id,chain:e.chain};a.push({name:"action",query:o})}function B(e){return`${e.sender} ${e.recipient} ${e.id}`}return{t:i,brightStyle:r,user:s,to:u,search:v,loadingSearch:m,moreAvailable:g,lastSearchId:w,updateIn:Z,updateOut:z,loadingUpdateIn:y,loadingUpdateOut:f,eosioStore:o,chain:h,showWalletDialog:o.showWalletDialog,inColumns:O,outColumns:K,inRows:N,outRows:R,shortAddress:T.shortAddress,shortenText:T.shortenText,onRowClick:F,rowKey:B,colorStatus:q.colorStatus}}});var z=o(11639),O=o(69885),K=o(68879),N=o(77580),R=o(13119),F=o(46858),B=o(31233),Q=o(67220),L=o(61357),$=o(69984),j=o.n($);const E=(0,z.Z)(Z,[["render",b]]),Y=E;j()(Z,"components",{QPage:O.Z,QBtn:K.Z,QTable:N.Z,QInput:R.Z,QTooltip:F.Z,QTr:B.Z,QTd:Q.Z,QAvatar:L.Z})}}]);